name: Semi-linear git history required

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  No-backmerges-in-PR:
    runs-on: ubuntu-latest
    if: github.repository != 'zoomin-software/.github'
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: Ensure needed refs fetched
        run: |
          git fetch origin +"${{ github.base_ref }}":target_branch +"${{ github.head_ref }}":feature_branch
          git branch -avv

      - name: Check for backwards merges master â†’ feature-branch
        run: |
          count=$(git rev-list --merges --count target_branch..feature_branch)
          test "$count" -eq 0 || {
            echo "Error: This PR contains merge commits. Kindly rebase your branch on top of latest ${{ github.base_ref }}." >&2
            exit 1
          }
